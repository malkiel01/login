<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniversalSearch - דוגמה לשימוש</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/universal-search.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f3f4f6;
        }
        
        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 40px;
        }
        
        .example-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .example-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: #f9fafb;
            padding: 12px;
            text-align: right;
            font-weight: 600;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        tr:hover {
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <h1>🔍 UniversalSearch - מערכת חיפוש מתקדמת</h1>
    
    <!-- דוגמה 1: חיפוש לקוחות פשוט -->
    <div class="example-section">
        <h2 class="example-title">דוגמה 1: חיפוש לקוחות בסיסי</h2>
        <div id="search1"></div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ת.ז</th>
                        <th>שם פרטי</th>
                        <th>שם משפחה</th>
                        <th>טלפון</th>
                        <th>אימייל</th>
                        <th>עיר</th>
                    </tr>
                </thead>
                <tbody id="results1"></tbody>
            </table>
        </div>
    </div>
    
    <!-- דוגמה 2: חיפוש לקוחות + רכישות -->
    <div class="example-section">
        <h2 class="example-title">דוגמה 2: חיפוש לקוחות עם רכישות</h2>
        <div id="search2"></div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>שם לקוח</th>
                        <th>ת.ז</th>
                        <th>מספר רכישה</th>
                        <th>מחיר</th>
                        <th>תאריך רכישה</th>
                    </tr>
                </thead>
                <tbody id="results2"></tbody>
            </table>
        </div>
    </div>
    
    <!-- דוגמה 3: חיפוש מתקדם מותאם אישית -->
    <div class="example-section">
        <h2 class="example-title">דוגמה 3: חיפוש מותאם אישית (Custom)</h2>
        <div id="search3"></div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>שם</th>
                        <th>טלפון</th>
                        <th>מספר רכישה</th>
                        <th>מחיר</th>
                    </tr>
                </thead>
                <tbody id="results3"></tbody>
            </table>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/universal-search.js"></script>
    <script src="js/search-presets.js"></script>
    
    <script>
        // ============================================
        // דוגמה 1: שימוש בתבנית מוכנה - לקוחות בלבד
        // ============================================
        const search1 = createSearchFromPreset('customers', {
            display: {
                containerSelector: '#search1'
            },
            results: {
                containerSelector: '#results1',
                renderFunction: (data, container) => {
                    if (data.length === 0) {
                        container.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 40px; color: #999;">לא נמצאו תוצאות</td></tr>';
                        return;
                    }
                    
                    container.innerHTML = data.map(customer => `
                        <tr>
                            <td>${customer.numId || '-'}</td>
                            <td>${customer.firstName || '-'}</td>
                            <td>${customer.lastName || '-'}</td>
                            <td>${customer.phone || '-'}</td>
                            <td>${customer.email || '-'}</td>
                            <td>${customer.city_name || '-'}</td>
                        </tr>
                    `).join('');
                }
            },
            callbacks: {
                onResults: (data) => {
                    console.log('✅ דוגמה 1: קיבלנו', data.total, 'תוצאות');
                }
            }
        });
        
        // ============================================
        // דוגמה 2: שימוש בתבנית - לקוחות + רכישות
        // ============================================
        const search2 = createSearchFromPreset('customersWithPurchases', {
            display: {
                containerSelector: '#search2'
            },
            results: {
                containerSelector: '#results2',
                renderFunction: (data, container) => {
                    if (data.length === 0) {
                        container.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; color: #999;">לא נמצאו תוצאות</td></tr>';
                        return;
                    }
                    
                    container.innerHTML = data.map(item => `
                        <tr>
                            <td>${item.customer_name || '-'}</td>
                            <td>${item.customer_id_number || '-'}</td>
                            <td>${item.purchase_serial || '-'}</td>
                            <td>${item.purchase_price ? item.purchase_price + ' ₪' : '-'}</td>
                            <td>${item.dateOpening ? new Date(item.dateOpening).toLocaleDateString('he-IL') : '-'}</td>
                        </tr>
                    `).join('');
                }
            }
        });
        
        // ============================================
        // דוגמה 3: תצורה מותאמת אישית לחלוטין
        // ============================================
        const search3 = new UniversalSearch({
            dataSource: {
                type: 'api',
                endpoint: '/dashboard/dashboards/cemeteries/api/universal-search-api.php',
                action: 'search',
                tables: ['customers'],
                joins: [
                    {
                        table: 'purchases',
                        on: 'customers.unicId = purchases.clientId',
                        type: 'LEFT'
                    }
                ]
            },
            
            searchableFields: [
                {
                    name: 'firstName',
                    label: 'שם לקוח',
                    table: 'customers',
                    type: 'text',
                    matchType: ['exact', 'fuzzy', 'startsWith']
                },
                {
                    name: 'phone',
                    label: 'טלפון',
                    table: 'customers',
                    type: 'text',
                    matchType: ['exact', 'fuzzy']
                },
                {
                    name: 'price',
                    label: 'מחיר',
                    table: 'purchases',
                    type: 'number',
                    matchType: ['exact', 'greaterThan', 'lessThan', 'between']
                },
                {
                    name: 'createDate',
                    label: 'תאריך',
                    table: 'customers',
                    type: 'date',
                    matchType: ['before', 'after', 'between', 'today', 'thisWeek', 'thisMonth']
                }
            ],
            
            display: {
                containerSelector: '#search3',
                showFilters: true,
                showAdvanced: true,
                layout: 'horizontal',
                placeholder: 'חיפוש מותאם אישית...',
                minSearchLength: 2,
                debounceDelay: 300
            },
            
            results: {
                containerSelector: '#results3',
                itemsPerPage: 50,
                showPagination: true,
                showCounter: true,
                renderFunction: (data, container) => {
                    if (data.length === 0) {
                        container.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 40px; color: #999;">לא נמצאו תוצאות</td></tr>';
                        return;
                    }
                    
                    container.innerHTML = data.map(item => `
                        <tr>
                            <td><strong>${item.firstName} ${item.lastName}</strong></td>
                            <td>${item.phone || '-'}</td>
                            <td>${item.purchase_serial || '-'}</td>
                            <td>${item.purchase_price ? item.purchase_price + ' ₪' : '-'}</td>
                        </tr>
                    `).join('');
                }
            },
            
            behavior: {
                realTime: true,
                autoSubmit: true,
                highlightResults: true
            },
            
            callbacks: {
                onSearch: (query, filters) => {
                    console.log('🔍 מחפש:', query, filters);
                },
                onResults: (data) => {
                    console.log('✅ קיבלנו', data.total, 'תוצאות');
                },
                onError: (error) => {
                    console.error('❌ שגיאה:', error);
                    alert('שגיאה בחיפוש: ' + error.message);
                }
            }
        });
        
        // ============================================
        // דוגמאות לשימוש ב-API הציבורי
        // ============================================
        
        // הוספת פילטר באופן פרוגרמטי
        function addPriceFilter() {
            search3.addFilter('price', 'greaterThan', 5000);
        }
        
        // הסרת פילטר
        function removePriceFilter() {
            search3.removeFilter('price');
        }
        
        // קבלת תוצאות
        function getResults() {
            const results = search3.getResults();
            console.log('📊 תוצאות נוכחיות:', results);
        }
        
        // רענון
        function refreshSearch() {
            search3.refresh();
        }
        
        console.log('🚀 UniversalSearch Examples loaded successfully!');
        console.log('📚 Available functions:', {
            addPriceFilter,
            removePriceFilter,
            getResults,
            refreshSearch
        });
    </script>
</body>
</html>