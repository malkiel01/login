Ö#!/usr/bin/php
<?php
/**
 * Smart Select Automatic Fix Script
 * ×™×•×¦×¨ ×•××¢×“×›×Ÿ ××ª ×›×œ ×”×§×‘×¦×™× ×”× ×“×¨×©×™× 
×œ××¢×¨×›×ª Smart Select
 * 
 * Usage: php fix-smart-select.php
 */

class SmartSelectFixer {
    
    private $basePath;
    private $cemeteryPath;
    private $formsPath;
    private $filesCreated = [];
    private $filesModified = [];
    private $backupDir;
    
    public function __construct() {
        // ×–×™×”×•×™ ××•×˜×•××˜×™ ×©×œ ×”× ×ª×™×‘
        $this->basePath = realpath(__DIR__);
        $this->cemeteryPath = $this->basePath . '/dashboard/dashboards/cemeteries';
        $this->formsPath = $this->cemeteryPath . '/forms';
        $this->backupDir = $this->basePath . '/backup_' . date('Y-m-d_His');
        
        echo "\n";
        echo "========================================\n";
        echo "   Smart Select - ×”×ª×§× ×” ××•×˜×•××˜×™×ª\n";
        echo "========================================\n";
        echo "ğŸ“ × ×ª×™×‘ ×‘×¡×™×¡: {$this->basePath}\n";
        echo "ğŸ“ × ×ª×™×‘ ×˜×¤×¡×™×: {$this->formsPath}\n";
        echo "\n";
    }
    
    /**
     * ×”×¨×¦×ª ×”×ª×™×§×•×Ÿ
     */
    public function run() {
        try {
            // ×©×œ×‘ 1: ×‘×“×™×§×•×ª ××§×“×™××•×ª
            $this->validateEnvironment();
            
            // ×©×œ×‘ 2: ×©××™×¨×ª ××¦×‘ × ×•×›×—×™ ×‘×’×™×˜
            $this->saveCurrentGitState();
            
            // ×©×œ×‘ 3: ×™×¦×™×¨×ª ×’×™×‘×•×™
            $this->createBackup();
            
            // ×©×œ×‘ 4: ×™×¦×™×¨×ª ×§×‘×¦×™× ×—×“×©×™×
            $this->createSmartSelectComponent();
            $this->createSmartSelectJS();
            $this->createSmartSelectCSS();
            
            // ×©×œ×‘ 5: ×¢×“×›×•×Ÿ ×§×‘×¦×™× ×§×™×™××™×
            $this->updateFormBuilder();
            $this->updateFormsConfig();
            $this->updateExistingForms();
            
            // ×©×œ×‘ 6: ×”×•×¡×¤×ª ×§×‘×¦×™ ×“×•×’××”
            $this->createExampleForm();
            
            // ×©×œ×‘ 7: commit ×•-push ×œ×’×™×˜
            $this->commitAndPushToGit();
            
            // ×¡×™×›×•×
            $this->printSummary();
            
        } catch (Exception $e) {
            echo "\nâŒ ×©×’×™××”: " . $e->getMessage() . "\n";
            $this->rollback();
            exit(1);
        }
    }
    
    /**
     * ×‘×“×™×§×ª ×¡×‘×™×‘×”
     */
    private function validateEnvironment() {
        echo "ğŸ” ×‘×•×“×§ ×¡×‘×™×‘×”...\n";
        
        if (!is_dir($this->cemeteryPath)) {
            throw new Exception("×ª×™×§×™×™×ª ×‘×ª×™ ×¢×œ××™×Ÿ ×œ× 
× ××¦××”: {$this->cemeteryPath}");
        }
        
        if (!is_dir($this->formsPath)) {
            throw new Exception("×ª×™×§×™×™×ª ×˜×¤×¡×™× ×œ× × ××¦××”: 
{$this->formsPath}");
        }
        
        if (!is_writable($this->formsPath)) {
            throw new Exception("××™×Ÿ ×”×¨×©××•×ª ×›×ª×™×‘×” 
×œ×ª×™×§×™×™×ª ×˜×¤×¡×™×");
        }
        
        // ×‘×“×•×§ ×©×’×™×˜ ××•×ª×§×Ÿ
        exec('which git 2>&1', $output, $returnCode);
        if ($returnCode !== 0) {
            throw new Exception("Git ×œ× ××•×ª×§×Ÿ ×‘××¢×¨×›×ª");
        }
        
        echo "âœ… ×”×¡×‘×™×‘×” ×ª×§×™× ×”\n\n";
    }
    
    /**
     * ×©××™×¨×ª ××¦×‘ × ×•×›×—×™ ×‘×’×™×˜
     */
    private function saveCurrentGitState() {
        echo "ğŸ’¾ ×©×•××¨ ××¦×‘ × ×•×›×—×™ ×‘×’×™×˜...\n";
        
        chdir($this->basePath);
        
        // ×‘×“×•×§ ×¡×˜×˜×•×¡
        exec('git status --porcelain 2>&1', $output, $returnCode);
        
        if (!empty($output)) {
            // ×™×© ×©×™× ×•×™×™× ×œ× ×©××•×¨×™× - ×©××•×¨ ××•×ª×
            exec('git add . 2>&1', $output, $returnCode);
            exec('git commit -m "Auto-save before Smart Select update" 2>&1', $output, 
$returnCode);
            echo "âœ… ×©×™× ×•×™×™× ×§×™×™××™× × ×©××¨×•\n";
        } else {
            echo "âœ… ××™×Ÿ ×©×™× ×•×™×™× ×œ× ×©××•×¨×™×\n";
        }
        
        echo "\n";
    }
    
    /**
     * ×™×¦×™×¨×ª ×’×™×‘×•×™
     */
    private function createBackup() {
        echo "ğŸ“¦ ×™×•×¦×¨ ×’×™×‘×•×™...\n";
        
        if (!mkdir($this->backupDir, 0755, true)) {
            throw new Exception("×œ× × ×™×ª×Ÿ ×œ×™×¦×•×¨ ×ª×™×§×™×™×ª 
×’×™×‘×•×™");
        }
        
        // ×’×‘×” ××ª ×ª×™×§×™×™×ª ×”×˜×¤×¡×™×
        $this->copyDirectory($this->formsPath, $this->backupDir . '/forms');
        
        echo "âœ… ×’×™×‘×•×™ × ×•×¦×¨ ×‘: {$this->backupDir}\n\n";
    }
    
    /**
     * ×™×¦×™×¨×ª SmartSelect Component
     */
    private function createSmartSelectComponent() {
        echo "ğŸ“ ×™×•×¦×¨ SmartSelect.php...\n";
        
        $content = '<?php
/**
 * SmartSelect Component
 * ×¨×›×™×‘ Select ×—×›× ×¢× ×ª××™×›×” ×‘×—×™×¤×•×© ×•×ª×¦×•×’×” 
××ª×§×“××ª
 * 
 * @version 1.0.0
 * @author Smart Select Fixer
 */

class SmartSelect {
    
    private $name;
    private $label;
    private $options = [];
    private $config = [];
    
    // ×”×’×“×¨×•×ª ×‘×¨×™×¨×ª ××—×“×œ
    private $defaults = [
        "searchable" => false,
        "display_mode" => "simple", // simple | advanced
        "placeholder" => "×‘×—×¨...",
        "search_placeholder" => "×—×¤×©...",
        "no_results_text" => "×œ× × ××¦××• ×ª×•×¦××•×ª",
        "required" => false,
        "disabled" => false,
        "multiple" => false,
        "ajax_url" => null,
        "min_search_length" => 2,
        "option_template" => null,
        "selected_template" => null,
        "max_items" => null,
        "allow_clear" => true,
        "rtl" => true
    ];
    
    public function __construct($name, $label, $options = [], $config = []) {
        $this->name = $name;
        $this->label = $label;
        $this->options = $options;
        $this->config = array_merge($this->defaults, $config);
    }
    
    /**
     * ×¨×™× ×“×•×¨ ×”×©×“×”
     */
    public function render() {
        $html = \'<div class="smart-select-container" data-name="\' . $this->name . \'">\';
        
        // Label
        $html .= $this->renderLabel();
        
        // Select element
        if ($this->config["searchable"]) {
            $html .= $this->renderSearchableSelect();
        } else {
            $html .= $this->renderSimpleSelect();
        }
        
        // Error message placeholder
        $html .= \'<div class="smart-select-error"></div>\';
        
        $html .= \'</div>\';
        
        // ×”×•×¡×£ JavaScript ×× ×¦×¨×™×š
        if ($this->config["searchable"] || $this->config["display_mode"] === "advanced") {
            $html .= $this->renderJavaScript();
        }
        
        return $html;
    }
    
    /**
     * ×¨×™× ×“×•×¨ Label
     */
    private function renderLabel() {
        $html = \'<label for="\' . $this->name . \'" class="smart-select-label">\';
        $html .= htmlspecialchars($this->label);
        if ($this->config["required"]) {
            $html .= \' <span class="text-danger">*</span>\';
        }
        $html .= \'</label>\';
        return $html;
    }
    
    /**
     * ×¨×™× ×“×•×¨ Select ×¤×©×•×˜
     */
    private function renderSimpleSelect() {
        $html = \'<select \';
        $html .= \'id="\' . $this->name . \'" \';
        $html .= \'name="\' . $this->name . \'" \';
        $html .= \'class="form-control smart-select" \';
        
        if ($this->config["required"]) {
            $html .= \'required \';
        }
        
        if ($this->config["disabled"]) {
            $html .= \'disabled \';
        }
        
        if ($this->config["multiple"]) {
            $html .= \'multiple \';
        }
        
        $html .= \'>\';
        
        // Placeholder option
        if (!$this->config["required"]) {
            $html .= \'<option value="">\' . htmlspecialchars($this->config["placeholder"]) 
. \'</option>\';
        }
        
        // Options
        foreach ($this->options as $value => $option) {
            $html .= $this->renderOption($value, $option);
        }
        
        $html .= \'</select>\';
        return $html;
    }
    
    /**
     * ×¨×™× ×“×•×¨ Select ×¢× ×—×™×¤×•×©
     */
    private function renderSearchableSelect() {
        $selectConfig = [
            "data-searchable" => "true",
            "data-search-placeholder" => $this->config["search_placeholder"],
            "data-no-results" => $this->config["no_results_text"],
            "data-min-search" => $this->config["min_search_length"],
            "data-display-mode" => $this->config["display_mode"]
        ];
        
        if ($this->config["ajax_url"]) {
            $selectConfig["data-ajax-url"] = $this->config["ajax_url"];
        }
        
        $html = \'<select \';
        $html .= \'id="\' . $this->name . \'" \';
        $html .= \'name="\' . $this->name . \'" \';
        $html .= \'class="form-control smart-select-searchable" \';
        
        foreach ($selectConfig as $attr => $value) {
            $html .= $attr . \'="\' . htmlspecialchars($value) . \'" \';
        }
        
        if ($this->config["required"]) {
            $html .= \'required \';
        }
        
        if ($this->config["disabled"]) {
            $html .= \'disabled \';
        }
        
        if ($this->config["multiple"]) {
            $html .= \'multiple \';
        }
        
        $html .= \'>\';
        
        // Options
        if (!$this->config["ajax_url"]) {
            if (!$this->config["required"]) {
                $html .= \'<option value="">\' . 
htmlspecialchars($this->config["placeholder"]) . \'</option>\';
            }
            
            foreach ($this->options as $value => $option) {
                $html .= $this->renderOption($value, $option);
            }
        }
        
        $html .= \'</select>\';
        return $html;
    }
    
    /**
     * ×¨×™× ×“×•×¨ Option
     */
    private function renderOption($value, $option) {
        // ×× ×–×” ××¢×¨×š - ×ª×¦×•×’×” ××ª×§×“××ª
        if (is_array($option)) {
            $text = $option["text"] ?? $option["title"] ?? $option["name"] ?? "";
            $subtitle = $option["subtitle"] ?? "";
            $badge = $option["badge"] ?? "";
            $disabled = $option["disabled"] ?? false;
            $selected = $option["selected"] ?? false;
            
            $html = \'<option value="\' . htmlspecialchars($value) . \'"\';
            
            // ×”×•×¡×£ data attributes
            if ($subtitle) {
                $html .= \' data-subtitle="\' . htmlspecialchars($subtitle) . \'"\';
            }
            if ($badge) {
                $html .= \' data-badge="\' . htmlspecialchars($badge) . \'"\';
            }
            
            if ($disabled) {
                $html .= \' disabled\';
            }
            
            if ($selected) {
                $html .= \' selected\';
            }
            
            $html .= \'>\';
            $html .= htmlspecialchars($text);
            $html .= \'</option>\';
            
            return $html;
        }
        
        // ××•×¤×¦×™×” ×¤×©×•×˜×”
        return \'<option value="\' . htmlspecialchars($value) . \'">\' . 
               htmlspecialchars($option) . \'</option>\';
    }
    
    /**
     * ×¨×™× ×“×•×¨ JavaScript
     */
    private function renderJavaScript() {
        $configJson = json_encode($this->config, JSON_UNESCAPED_UNICODE);
        
        return \'
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                SmartSelectManager.init("\' . $this->name . \'", \' . $configJson . \');
            });
        </script>\';
    }
    
    /**
     * ×”×’×“×¨×ª ×¢×¨×š
     */
    public function setValue($value) {
        $this->config["value"] = $value;
        return $this;
    }
    
    /**
     * ×”×’×“×¨×ª ××•×¤×¦×™×•×ª
     */
    public function setOptions($options) {
        $this->options = $options;
        return $this;
    }
    
    /**
     * ×”×•×¡×¤×ª ××•×¤×¦×™×”
     */
    public function addOption($value, $text, $data = []) {
        if (!empty($data)) {
            $this->options[$value] = array_merge(["text" => $text], $data);
        } else {
            $this->options[$value] = $text;
        }
        return $this;
    }
    
    /**
     * ×”×¤×¢×œ×ª ×—×™×¤×•×©
     */
    public function enableSearch($placeholder = "×—×¤×©...") {
        $this->config["searchable"] = true;
        $this->config["search_placeholder"] = $placeholder;
        return $this;
    }
    
    /**
     * ×”×’×“×¨×ª ×ª×¦×•×’×” ××ª×§×“××ª
     */
    public function setAdvancedDisplay($template = null) {
        $this->config["display_mode"] = "advanced";
        if ($template) {
            $this->config["option_template"] = $template;
        }
        return $this;
    }
    
    /**
     * ×”×’×“×¨×ª AJAX
     */
    public function setAjaxUrl($url, $minLength = 2) {
        $this->config["ajax_url"] = $url;
        $this->config["min_search_length"] = $minLength;
        return $this;
    }
    
    /**
     * ×™×¦×™×¨×ª instance ×—×“×© (static factory)
     */
    public static function create($name, $label, $options = [], $config = []) {
        return new self($name, $label, $options, $config);
    }
}
?>';
        
        $filePath = $this->formsPath . '/SmartSelect.php';
        if (file_put_contents($filePath, $content)) {
            $this->filesCreated[] = 'SmartSelect.php';
            echo "âœ… SmartSelect.php × ×•×¦×¨ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * ×™×¦×™×¨×ª JavaScript
     */
    private function createSmartSelectJS() {
        echo "ğŸ“ ×™×•×¦×¨ smart-select.js...\n";
        
        $content = '/**
 * SmartSelect JavaScript Manager
 * ×× ×”×œ ××ª ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×©×œ SmartSelect ×‘×¦×“ 
×”×œ×§×•×—
 * 
 * @version 1.0.0
 */

window.SmartSelectManager = {
    
    instances: {},
    
    /**
     * ××ª×—×•×œ SmartSelect
     */
    init: function(name, config) {
        const element = document.getElementById(name);
        if (!element) {
            console.error("SmartSelect: Element not found:", name);
            return;
        }
        
        // ×©××•×¨ ××ª ×”××•×¤×¢
        this.instances[name] = {
            element: element,
            config: config,
            originalOptions: this.extractOptions(element),
            isInitialized: false
        };
        
        // ××ª×—×œ ×œ×¤×™ ×¡×•×’
        if (config.searchable) {
            this.initSearchable(name);
        }
        
        if (config.display_mode === "advanced") {
            this.initAdvancedDisplay(name);
        }
        
        // ×¡××Ÿ ×›×××•×ª×—×œ
        this.instances[name].isInitialized = true;
        
        // ×”×¤×¢×œ event
        element.dispatchEvent(new CustomEvent("smartselect:init", { detail: config }));
    },
    
    /**
     * ××ª×—×•×œ ×—×™×¤×•×©
     */
    initSearchable: function(name) {
        const instance = this.instances[name];
        const element = instance.element;
        const config = instance.config;
        
        // ×™×¦×™×¨×ª wrapper
        const wrapper = document.createElement("div");
        wrapper.className = "smart-select-searchable-wrapper";
        element.parentNode.insertBefore(wrapper, element);
        
        // ×™×¦×™×¨×ª ×©×“×” ×—×™×¤×•×©
        const searchInput = document.createElement("input");
        searchInput.type = "text";
        searchInput.className = "smart-select-search";
        searchInput.placeholder = config.search_placeholder || "×—×¤×©...";
        
        // ×™×¦×™×¨×ª dropdown
        const dropdown = document.createElement("div");
        dropdown.className = "smart-select-dropdown";
        dropdown.style.display = "none";
        
        // ×”×¢×‘×¨ ××ª ×”-select ×œ-dropdown
        dropdown.appendChild(element);
        
        // ×”×•×¡×£ ×œ×¢×˜×™×¤×”
        wrapper.appendChild(searchInput);
        wrapper.appendChild(dropdown);
        
        // ×™×¦×™×¨×ª ×ª×¦×•×’×” ×©×œ ×”×‘×—×™×¨×”
        const selectedDisplay = document.createElement("div");
        selectedDisplay.className = "smart-select-selected";
        selectedDisplay.textContent = config.placeholder || "×‘×—×¨...";
        wrapper.insertBefore(selectedDisplay, searchInput);
        
        // ×”×¡×ª×¨ ××ª ×©×“×” ×”×—×™×¤×•×© ×‘×”×ª×—×œ×”
        searchInput.style.display = "none";
        
        // ××™×¨×•×¢×™×
        this.bindSearchEvents(name, searchInput, dropdown, selectedDisplay);
        
        // ×× ×™×© AJAX
        if (config.ajax_url) {
            this.initAjax(name, searchInput);
        }
    },
    
    /**
     * ×—×™×‘×•×¨ ××™×¨×•×¢×™ ×—×™×¤×•×©
     */
    bindSearchEvents: function(name, searchInput, dropdown, selectedDisplay) {
        const instance = this.instances[name];
        const element = instance.element;
        const config = instance.config;
        
        let isOpen = false;
        
        // ×¤×ª×™×—×” ×‘×œ×—×™×¦×” ×¢×œ ×”×ª×¦×•×’×”
        selectedDisplay.addEventListener("click", function() {
            isOpen = !isOpen;
            
            if (isOpen) {
                dropdown.style.display = "block";
                searchInput.style.display = "block";
                searchInput.focus();
                selectedDisplay.classList.add("active");
            } else {
                dropdown.style.display = "none";
                searchInput.style.display = "none";
                selectedDisplay.classList.remove("active");
            }
        });
        
        // ×—×™×¤×•×©
        let searchTimeout;
        searchInput.addEventListener("input", function(e) {
            clearTimeout(searchTimeout);
            const query = e.target.value.toLowerCase();
            
            searchTimeout = setTimeout(() => {
                if (config.ajax_url) {
                    // ×—×™×¤×•×© AJAX
                    instance.ajaxSearch(query);
                } else {
                    // ×—×™×¤×•×© ××§×•××™
                    const options = element.querySelectorAll("option");
                    let hasResults = false;
                    
                    options.forEach(option => {
                        if (!option.value) return; // ×“×œ×’ ×¢×œ placeholder
                        
                        const text = option.textContent.toLowerCase();
                        const subtitle = option.dataset.subtitle || "";
                        const match = text.includes(query) || 
subtitle.toLowerCase().includes(query);
                        
                        if (match) {
                            option.style.display = "";
                            hasResults = true;
                        } else {
                            option.style.display = "none";
                        }
                    });
                    
                    // ×”×¦×’ ×”×•×“×¢×” ×× ××™×Ÿ ×ª×•×¦××•×ª
                    if (!hasResults && query.length >= config.min_search_length) {
                        const noResults = dropdown.querySelector(".no-results");
                        if (!noResults) {
                            const msg = document.createElement("div");
                            msg.className = "no-results";
                            msg.textContent = config.no_results_text || "×œ× 
× ××¦××• ×ª×•×¦××•×ª";
                            dropdown.appendChild(msg);
                        }
                    } else {
                        const noResults = dropdown.querySelector(".no-results");
                        if (noResults) noResults.remove();
                    }
                }
            }, 300); // Debounce
        });
        
        // ×‘×—×™×¨×ª ××•×¤×¦×™×”
        element.addEventListener("change", function() {
            const selected = element.options[element.selectedIndex];
            if (selected) {
                // ×¢×“×›×Ÿ ×ª×¦×•×’×”
                if (config.display_mode === "advanced" && selected.dataset.subtitle) {
                    selectedDisplay.innerHTML = `
                        <div class="smart-select-title">${selected.textContent}</div>
                        <div 
class="smart-select-subtitle">${selected.dataset.subtitle}</div>
                    `;
                } else {
                    selectedDisplay.textContent = selected.textContent;
                }
                
                // ×¡×’×•×¨ dropdown
                dropdown.style.display = "none";
                searchInput.style.display = "none";
                searchInput.value = "";
                selectedDisplay.classList.remove("active");
                isOpen = false;
                
                // ×”×—×–×¨ ××ª ×›×œ ×”××•×¤×¦×™×•×ª
                const options = element.querySelectorAll("option");
                options.forEach(option => option.style.display = "");
            }
        });
        
        // ×¡×’×™×¨×” ×‘×œ×—×™×¦×” ××—×•×¥ ×œ××œ×× ×˜
        document.addEventListener("click", function(e) {
            if (!e.target.closest(".smart-select-searchable-wrapper")) {
                dropdown.style.display = "none";
                searchInput.style.display = "none";
                selectedDisplay.classList.remove("active");
                isOpen = false;
            }
        });
    },
    
    /**
     * ××ª×—×•×œ ×ª×¦×•×’×” ××ª×§×“××ª
     */
    initAdvancedDisplay: function(name) {
        const instance = this.instances[name];
        const element = instance.element;
        const config = instance.config;
        
        // ×¢×™×¦×•×‘ ××•×¤×¦×™×•×ª
        const options = element.querySelectorAll("option");
        options.forEach(option => {
            if (option.dataset.subtitle || option.dataset.badge) {
                // ×™×¦×™×¨×ª HTML ××•×ª×× ××™×©×™×ª
                const customOption = document.createElement("div");
                customOption.className = "smart-select-option-advanced";
                customOption.dataset.value = option.value;
                
                let html = `<div class="option-title">${option.textContent}</div>`;
                
                if (option.dataset.subtitle) {
                    html += `<div 
class="option-subtitle">${option.dataset.subtitle}</div>`;
                }
                
                if (option.dataset.badge) {
                    html += `<div class="option-badge">${option.dataset.badge}</div>`;
                }
                
                customOption.innerHTML = html;
                
                // ×©××•×¨ reference
                option._customDisplay = customOption;
            }
        });
    },
    
    /**
     * ××ª×—×•×œ AJAX
     */
    initAjax: function(name, searchInput) {
        const instance = this.instances[name];
        const config = instance.config;
        
        instance.ajaxSearch = function(query) {
            if (query.length < config.min_search_length) {
                return;
            }
            
            // ×”×¦×’ loader
            const loader = document.createElement("div");
            loader.className = "smart-select-loader";
            loader.textContent = "×˜×•×¢×Ÿ...";
            searchInput.parentNode.appendChild(loader);
            
            // ×‘×¦×¢ ×§×¨×™××ª AJAX
            fetch(config.ajax_url + "?q=" + encodeURIComponent(query))
                .then(response => response.json())
                .then(data => {
                    // × ×§×” ××•×¤×¦×™×•×ª ×§×™×™××•×ª
                    const element = instance.element;
                    element.innerHTML = "";
                    
                    // ×”×•×¡×£ ×ª×•×¦××•×ª
                    if (data.results && data.results.length > 0) {
                        data.results.forEach(item => {
                            const option = document.createElement("option");
                            option.value = item.value || item.id;
                            option.textContent = item.text || item.name;
                            
                            if (item.subtitle) {
                                option.dataset.subtitle = item.subtitle;
                            }
                            if (item.badge) {
                                option.dataset.badge = item.badge;
                            }
                            
                            element.appendChild(option);
                        });
                    } else {
                        // ××™×Ÿ ×ª×•×¦××•×ª
                        const noResults = document.createElement("option");
                        noResults.disabled = true;
                        noResults.textContent = config.no_results_text || "×œ× 
× ××¦××• ×ª×•×¦××•×ª";
                        element.appendChild(noResults);
                    }
                })
                .catch(error => {
                    console.error("SmartSelect AJAX Error:", error);
                })
                .finally(() => {
                    // ×”×¡×¨ loader
                    if (loader && loader.parentNode) {
                        loader.remove();
                    }
                });
        };
    },
    
    /**
     * ×—×™×œ×•×¥ ××•×¤×¦×™×•×ª ×-select ×§×™×™×
     */
    extractOptions: function(element) {
        const options = [];
        element.querySelectorAll("option").forEach(option => {
            options.push({
                value: option.value,
                text: option.textContent,
                subtitle: option.dataset.subtitle,
                badge: option.dataset.badge,
                disabled: option.disabled,
                selected: option.selected
            });
        });
        return options;
    },
    
    /**
     * ××™×¤×•×¡ ×œ×¢×¨×›×™× ××§×•×¨×™×™×
     */
    reset: function(name) {
        const instance = this.instances[name];
        if (!instance) return;
        
        const element = instance.element;
        const originalOptions = instance.originalOptions;
        
        // × ×§×” ×•××ª×—×œ ××—×“×©
        element.innerHTML = "";
        originalOptions.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.text;
            if (opt.subtitle) option.dataset.subtitle = opt.subtitle;
            if (opt.badge) option.dataset.badge = opt.badge;
            if (opt.disabled) option.disabled = true;
            if (opt.selected) option.selected = true;
            element.appendChild(option);
        });
        
        // ×”×¤×¢×œ event
        element.dispatchEvent(new CustomEvent("smartselect:reset"));
    },
    
    /**
     * ×¢×“×›×•×Ÿ ××•×¤×¦×™×•×ª
     */
    updateOptions: function(name, newOptions) {
        const instance = this.instances[name];
        if (!instance) return;
        
        const element = instance.element;
        
        // × ×§×” ××•×¤×¦×™×•×ª ×§×™×™××•×ª
        element.innerHTML = "";
        
        // ×”×•×¡×£ ××•×¤×¦×™×•×ª ×—×“×©×•×ª
        newOptions.forEach(opt => {
            const option = document.createElement("option");
            
            if (typeof opt === "object") {
                option.value = opt.value || opt.id;
                option.textContent = opt.text || opt.name;
                if (opt.subtitle) option.dataset.subtitle = opt.subtitle;
                if (opt.badge) option.dataset.badge = opt.badge;
                if (opt.disabled) option.disabled = true;
                if (opt.selected) option.selected = true;
            } else {
                option.value = opt;
                option.textContent = opt;
            }
            
            element.appendChild(option);
        });
        
        // ×”×¤×¢×œ event
        element.dispatchEvent(new CustomEvent("smartselect:update", { detail: newOptions 
}));
    },
    
    /**
     * ×§×‘×œ×ª ×¢×¨×š × ×‘×—×¨
     */
    getValue: function(name) {
        const instance = this.instances[name];
        if (!instance) return null;
        
        return instance.element.value;
    },
    
    /**
     * ×”×’×“×¨×ª ×¢×¨×š
     */
    setValue: function(name, value) {
        const instance = this.instances[name];
        if (!instance) return;
        
        instance.element.value = value;
        instance.element.dispatchEvent(new Event("change"));
    },
    
    /**
     * ×”×©×‘×ª×”/×”×¤×¢×œ×”
     */
    setEnabled: function(name, enabled) {
        const instance = this.instances[name];
        if (!instance) return;
        
        instance.element.disabled = !enabled;
        
        // ×¢×“×›×Ÿ ×’× ××ª ×”×××©×§
        const wrapper = instance.element.closest(".smart-select-searchable-wrapper");
        if (wrapper) {
            if (enabled) {
                wrapper.classList.remove("disabled");
            } else {
                wrapper.classList.add("disabled");
            }
        }
    },
    
    /**
     * × ×™×§×•×™
     */
    destroy: function(name) {
        const instance = this.instances[name];
        if (!instance) return;
        
        // ×”×—×–×¨ ×œ××¦×‘ ×”××§×•×¨×™
        const element = instance.element;
        const wrapper = element.closest(".smart-select-searchable-wrapper");
        
        if (wrapper) {
            // ×”×—×–×¨ ××ª ×”-select ×œ××§×•××• ×”××§×•×¨×™
            wrapper.parentNode.insertBefore(element, wrapper);
            wrapper.remove();
        }
        
        // × ×§×” ××”×–×™×›×¨×•×Ÿ
        delete this.instances[name];
        
        // ×”×¤×¢×œ event
        element.dispatchEvent(new CustomEvent("smartselect:destroy"));
    }
};';
        
        $jsPath = $this->cemeteryPath . '/js';
        if (!is_dir($jsPath)) {
            mkdir($jsPath, 0755, true);
        }
        
        $filePath = $jsPath . '/smart-select.js';
        if (file_put_contents($filePath, $content)) {
            $this->filesCreated[] = 'js/smart-select.js';
            echo "âœ… smart-select.js × ×•×¦×¨ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * ×™×¦×™×¨×ª CSS
     */
    private function createSmartSelectCSS() {
        echo "ğŸ“ ×™×•×¦×¨ smart-select.css...\n";
        
        $content = '/**
 * SmartSelect Styles
 * ×¢×™×¦×•×‘ ×œ×¨×›×™×‘×™ SmartSelect
 * 
 * @version 1.0.0
 */

/* Container */
.smart-select-container {
    position: relative;
    margin-bottom: 1rem;
}

.smart-select-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #374151;
}

/* Simple Select */
.smart-select {
    width: 100%;
    padding: 0.625rem 0.875rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    background-color: white;
    color: #1f2937;
    font-size: 0.875rem;
    transition: all 0.2s;
    cursor: pointer;
}

.smart-select:hover {
    border-color: #9ca3af;
}

.smart-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.smart-select:disabled {
    background-color: #f3f4f6;
    cursor: not-allowed;
    opacity: 0.6;
}

/* Searchable Wrapper */
.smart-select-searchable-wrapper {
    position: relative;
    width: 100%;
}

.smart-select-searchable-wrapper.disabled {
    pointer-events: none;
    opacity: 0.6;
}

/* Selected Display */
.smart-select-selected {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.625rem 0.875rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    background-color: white;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    min-height: 42px;
}

.smart-select-selected:hover {
    border-color: #9ca3af;
}

.smart-select-selected.active {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.smart-select-selected::after {
    content: "â–¼";
    font-size: 0.75rem;
    color: #6b7280;
    position: absolute;
    left: 0.875rem;
    top: 50%;
    transform: translateY(-50%);
    transition: transform 0.2s;
}

.smart-select-selected.active::after {
    transform: translateY(-50%) rotate(180deg);
}

/* RTL Support */
[dir="rtl"] .smart-select-selected::after {
    left: auto;
    right: 0.875rem;
}

/* Search Input */
.smart-select-search {
    width: 100%;
    padding: 0.5rem 0.875rem;
    border: none;
    border-bottom: 1px solid #e5e7eb;
    outline: none;
    font-size: 0.875rem;
    background: white;
}

.smart-select-search:focus {
    border-bottom-color: #667eea;
}

/* Dropdown */
.smart-select-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #d1d5db;
    border-top: none;
    border-radius: 0 0 0.5rem 0.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
}

/* Custom Scrollbar */
.smart-select-dropdown::-webkit-scrollbar {
    width: 6px;
}

.smart-select-dropdown::-webkit-scrollbar-track {
    background: #f3f4f6;
}

.smart-select-dropdown::-webkit-scrollbar-thumb {
    background: #9ca3af;
    border-radius: 3px;
}

.smart-select-dropdown::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
}

/* Options */
.smart-select-dropdown option {
    padding: 0.625rem 0.875rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.smart-select-dropdown option:hover {
    background-color: #f3f4f6;
}

.smart-select-dropdown option:disabled {
    color: #9ca3af;
    cursor: not-allowed;
}

.smart-select-dropdown option[selected] {
    background-color: #ede9fe;
    font-weight: 600;
}

/* Advanced Display */
.smart-select-title {
    font-weight: 600;
    color: #1f2937;
}

.smart-select-subtitle {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.125rem;
}

.option-badge {
    display: inline-block;
    padding: 0.125rem 0.5rem;
    background-color: #667eea;
    color: white;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    margin-right: 0.5rem;
}

/* Advanced Option */
.smart-select-option-advanced {
    padding: 0.75rem;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
    transition: background-color 0.2s;
}

.smart-select-option-advanced:hover {
    background-color: #f9fafb;
}

.smart-select-option-advanced:last-child {
    border-bottom: none;
}

.option-title {
    font-weight: 500;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.option-subtitle {
    font-size: 0.8125rem;
    color: #6b7280;
}

/* No Results */
.no-results {
    padding: 1rem;
    text-align: center;
    color: #6b7280;
    font-style: italic;
}

/* Loader */
.smart-select-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 0.5rem 1rem;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    z-index: 1001;
}

/* Error Message */
.smart-select-error {
    color: #dc2626;
    font-size: 0.8125rem;
    margin-top: 0.25rem;
}

/* Multiple Selection */
.smart-select[multiple] {
    min-height: 120px;
}

.smart-select-selected-items {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.selected-item {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    background-color: #ede9fe;
    border: 1px solid #c7d2fe;
    border-radius: 0.25rem;
    font-size: 0.875rem;
}

.selected-item-remove {
    cursor: pointer;
    color: #6b7280;
    font-weight: bold;
}

.selected-item-remove:hover {
    color: #dc2626;
}

/* Animations */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.smart-select-dropdown {
    animation: slideDown 0.2s ease-out;
}

/* Responsive */
@media (max-width: 640px) {
    .smart-select-dropdown {
        max-height: 200px;
    }
    
    .smart-select,
    .smart-select-selected,
    .smart-select-search {
        font-size: 16px; /* ××•× ×¢ zoom ×‘××™×™×¤×•×Ÿ */
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    .smart-select,
    .smart-select-selected,
    .smart-select-search,
    .smart-select-dropdown {
        background-color: #1f2937;
        color: #f3f4f6;
        border-color: #4b5563;
    }
    
    .smart-select:hover,
    .smart-select-selected:hover {
        border-color: #6b7280;
    }
    
    .smart-select-dropdown option:hover,
    .smart-select-option-advanced:hover {
        background-color: #374151;
    }
    
    .smart-select-label,
    .option-title {
        color: #f3f4f6;
    }
    
    .smart-select-subtitle,
    .option-subtitle {
        color: #9ca3af;
    }
}';
        
        $cssPath = $this->cemeteryPath . '/css';
        if (!is_dir($cssPath)) {
            mkdir($cssPath, 0755, true);
        }
        
        $filePath = $cssPath . '/smart-select.css';
        if (file_put_contents($filePath, $content)) {
            $this->filesCreated[] = 'css/smart-select.css';
            echo "âœ… smart-select.css × ×•×¦×¨ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * ×¢×“×›×•×Ÿ FormBuilder
     */
    private function updateFormBuilder() {
        echo "ğŸ“ ××¢×“×›×Ÿ FormBuilder.php...\n";
        
        $filePath = $this->formsPath . '/FormBuilder.php';
        if (!file_exists($filePath)) {
            echo "âš ï¸ FormBuilder.php ×œ× × ××¦×, ××“×œ×’...\n";
            return;
        }
        
        // ×§×¨× ××ª ×”×§×•×‘×¥
        $content = file_get_contents($filePath);
        
        // ×‘×“×•×§ ×× ×›×‘×¨ ×™×© ×ª××™×›×” ×‘-SmartSelect
        if (strpos($content, 'renderSmartSelect') !== false) {
            echo "â„¹ï¸ FormBuilder ×›×‘×¨ ××¢×•×“×›×Ÿ\n";
            return;
        }
        
        // ×”×•×¡×£ require_once ×‘×ª×—×™×œ×ª ×”×§×•×‘×¥
        $searchPattern = '/<\?php/';
        $replacement = '<?php
require_once __DIR__ . \'/SmartSelect.php\';';
        $content = preg_replace($searchPattern, $replacement, $content, 1);
        
        // ×”×•×¡×£ ××ª×•×“×” renderSmartSelect ×œ×¤× ×™ ×”×¡×•×’×¨ 
×”××—×¨×•×Ÿ ×©×œ ×”××—×œ×§×”
        $newMethod = '
    
    /**
     * ×¨×™× ×“×•×¨ Smart Select
     * @param array $field
     * @return string
     */
    private function renderSmartSelect($field) {
        $config = [
            "searchable" => $field["searchable"] ?? false,
            "display_mode" => $field["display_mode"] ?? "simple",
            "placeholder" => $field["placeholder"] ?? "×‘×—×¨...",
            "required" => $field["required"] ?? false,
            "disabled" => $field["readonly"] ?? false,
            "ajax_url" => $field["ajax_url"] ?? null,
            "option_template" => $field["option_template"] ?? null
        ];
        
        $smartSelect = new SmartSelect(
            $field["name"],
            $field["label"],
            $field["options"] ?? [],
            $config
        );
        
        if (isset($field["value"])) {
            $smartSelect->setValue($field["value"]);
        }
        
        return $smartSelect->render();
    }';
        
        // ××¦× ××ª ×”××§×•× ×”× ×›×•×Ÿ ×œ×”×•×¡×™×£ ××ª 
×”××ª×•×“×” (×œ×¤× ×™ ×”×¡×•×’×¨ ×”××—×¨×•×Ÿ ×©×œ ×”××—×œ×§×”)
        $lastBrace = strrpos($content, '}');
        $content = substr($content, 0, $lastBrace) . $newMethod . "\n" . substr($content, 
$lastBrace);
        
        // ×¢×“×›×Ÿ ××ª renderField ×œ×”×•×¡×™×£ ×ª××™×›×” ×‘-smart_select
        $searchPattern = '/case \'select\':\s*\$html \.\= 
\$this->renderSelect\(\$field\);\s*break;/';
        $replacement = 'case \'select\':
                $html .= $this->renderSelect($field);
                break;
            case \'smart_select\':
                return $this->renderSmartSelect($field);';
        
        $content = preg_replace($searchPattern, $replacement, $content);
        
        // ×©××•×¨ ××ª ×”×§×•×‘×¥
        if (file_put_contents($filePath, $content)) {
            $this->filesModified[] = 'FormBuilder.php';
            echo "âœ… FormBuilder.php ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * ×¢×“×›×•×Ÿ forms-config.php
     */
    private function updateFormsConfig() {
        echo "ğŸ“ ××¢×“×›×Ÿ forms-config.php...\n";
        
        $filePath = $this->formsPath . '/forms-config.php';
        if (!file_exists($filePath)) {
            echo "âš ï¸ forms-config.php ×œ× × ××¦×, ××“×œ×’...\n";
            return;
        }
        
        // ×™×¦×™×¨×ª ×ª×•×¡×¤×ª ×œ×§×•×‘×¥
        $addition = '

/**
 * ×”×’×“×¨×ª SmartSelect ×œ×©×“×”
 * @param string $fieldName
 * @param array $options
 * @return array
 */
function configureSmartSelect($fieldName, $options = []) {
    $defaults = [
        "type" => "smart_select",
        "searchable" => true,
        "display_mode" => "simple"
    ];
    
    return array_merge($defaults, $options);
}';
        
        $content = file_get_contents($filePath);
        
        // ×‘×“×•×§ ×× ×›×‘×¨ ×™×© ××ª ×”×¤×•× ×§×¦×™×”
        if (strpos($content, 'configureSmartSelect') === false) {
            // ×”×•×¡×£ ×œ×¤× ×™ ×”-?> ×”××—×¨×•×Ÿ
            $content = str_replace('?>', $addition . "\n?>", $content);
            
            if (file_put_contents($filePath, $content)) {
                $this->filesModified[] = 'forms-config.php';
                echo "âœ… forms-config.php ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”\n";
            }
        } else {
            echo "â„¹ï¸ forms-config.php ×›×‘×¨ ××¢×•×“×›×Ÿ\n";
        }
    }
    
    /**
     * ×¢×“×›×•×Ÿ ×˜×¤×¡×™× ×§×™×™××™×
     */
    private function updateExistingForms() {
        echo "ğŸ“ ××¢×“×›×Ÿ index.php...\n";
        
        $indexPath = $this->cemeteryPath . '/index.php';
        if (!file_exists($indexPath)) {
            echo "âš ï¸ index.php ×œ× × ××¦×, ××“×œ×’...\n";
            return;
        }
        
        $content = file_get_contents($indexPath);
        
        // ×”×•×¡×£ ××ª ×§×‘×¦×™ ×”-CSS ×•×”-JS
        $cssLink = '<link rel="stylesheet" 
href="/dashboard/dashboards/cemeteries/css/smart-select.css">';
        $jsScript = '<script 
src="/dashboard/dashboards/cemeteries/js/smart-select.js"></script>';
        
        // ×”×•×¡×£ CSS ××—×¨×™ ×”-forms.css
        if (strpos($content, 'smart-select.css') === false) {
            $content = str_replace(
                '<link rel="stylesheet" 
href="/dashboard/dashboards/cemeteries/css/forms.css">',
                '<link rel="stylesheet" 
href="/dashboard/dashboards/cemeteries/css/forms.css">' . "\n    " . $cssLink,
                $content
            );
        }
        
        // ×”×•×¡×£ JS ×œ×¤× ×™ ×¡×’×™×¨×ª ×”-body
        if (strpos($content, 'smart-select.js') === false) {
            $content = str_replace(
                '</body>',
                '    ' . $jsScript . "\n</body>",
                $content
            );
        }
        
        if (file_put_contents($indexPath, $content)) {
            $this->filesModified[] = 'index.php';
            echo "âœ… index.php ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * ×™×¦×™×¨×ª ×˜×•×¤×¡ ×“×•×’××”
     */
    private function createExampleForm() {
        echo "ğŸ“ ×™×•×¦×¨ smart-select-example.php...\n";
        
        $content = '<?php
/**
 * ×“×•×’××” ×œ×©×™××•×© ×‘-SmartSelect
 */

require_once __DIR__ . \'/FormBuilder.php\';
require_once dirname(__DIR__) . \'/config.php\';

// ×™×¦×™×¨×ª FormBuilder
$formBuilder = new FormBuilder(\'smart_select_example\', null, null);

// ×“×•×’××” 1: Select ×¤×©×•×˜ (×›××• ×§×•×“×)
$formBuilder->addField(\'simple_select\', \'×‘×—×™×¨×” ×¤×©×•×˜×”\', \'select\', [
    \'options\' => [
        \'option1\' => \'××•×¤×¦×™×” 1\',
        \'option2\' => \'××•×¤×¦×™×” 2\',
        \'option3\' => \'××•×¤×¦×™×” 3\'
    ]
]);

// ×“×•×’××” 2: Smart Select ×¢× ×—×™×¤×•×©
$formBuilder->addField(\'searchable_select\', \'×‘×—×™×¨×” ×¢× ×—×™×¤×•×©\', 
\'smart_select\', [
    \'searchable\' => true,
    \'placeholder\' => \'×”×§×œ×“ ×œ×—×™×¤×•×©...\',
    \'options\' => [
        \'jerusalem\' => \'×™×¨×•×©×œ×™×\',
        \'telaviv\' => \'×ª×œ ××‘×™×‘\',
        \'haifa\' => \'×—×™×¤×”\',
        \'beersheva\' => \'×‘××¨ ×©×‘×¢\',
        \'netanya\' => \'× ×ª× ×™×”\',
        \'ashdod\' => \'××©×“×•×“\'
    ]
]);

// ×“×•×’××” 3: Smart Select ×¢× ×ª×¦×•×’×” ××ª×§×“××ª
$advancedOptions = [];
$advancedOptions[\'cem1\'] = [
    \'text\' => \'×‘×™×ª ×¢×œ××™×Ÿ ×”×¨ ×”×× ×•×—×•×ª\',
    \'subtitle\' => \'×™×¨×•×©×œ×™×\',
    \'badge\' => \'150 ×§×‘×¨×™× ×¤× ×•×™×™×\'
];
$advancedOptions[\'cem2\'] = [
    \'text\' => \'×‘×™×ª ×¢×œ××™×Ÿ ×™×”×§×™×\',
    \'subtitle\' => \'×ª×œ ××‘×™×‘\',
    \'badge\' => \'75 ×§×‘×¨×™× ×¤× ×•×™×™×\'
];
$advancedOptions[\'cem3\'] = [
    \'text\' => \'×‘×™×ª ×¢×œ××™×Ÿ ×—×™×¤×”\',
    \'subtitle\' => \'×—×™×¤×”\',
    \'badge\' => \'××™×Ÿ ×§×‘×¨×™× ×¤× ×•×™×™×\',
    \'disabled\' => true
];

$formBuilder->addField(\'advanced_select\', \'×‘×—×™×¨×ª ×‘×™×ª ×¢×œ××™×Ÿ\', 
\'smart_select\', [
    \'searchable\' => true,
    \'display_mode\' => \'advanced\',
    \'placeholder\' => \'×‘×—×¨ ×‘×™×ª ×¢×œ××™×Ÿ...\',
    \'options\' => $advancedOptions
]);

// ×“×•×’××” 4: Smart Select ×¢× AJAX
$formBuilder->addField(\'ajax_select\', \'×—×™×¤×•×© ×œ×§×•×—\', \'smart_select\', [
    \'searchable\' => true,
    \'ajax_url\' => \'/dashboard/dashboards/cemeteries/api/search-customers.php\',
    \'placeholder\' => \'×”×§×œ×“ ×©× ×œ×§×•×—...\',
    \'min_search_length\' => 3
]);

// ×”×¦×’×ª ×”×˜×•×¤×¡
echo $formBuilder->renderModal();
?>';
        
        $filePath = $this->formsPath . '/smart-select-example.php';
        if (file_put_contents($filePath, $content)) {
            $this->filesCreated[] = 'smart-select-example.php';
            echo "âœ… smart-select-example.php × ×•×¦×¨ ×‘×”×¦×œ×—×”\n";
        }
    }
    
    /**
     * Commit ×•-Push ×œ×’×™×˜
     */
    private function commitAndPushToGit() {
        echo "\nğŸ’¾ ××¢×œ×” ×œ×’×™×˜...\n";
        
        chdir($this->basePath);
        
        // ×”×•×¡×£ ××ª ×›×œ ×”×©×™× ×•×™×™×
        exec('git add . 2>&1', $output, $returnCode);
        
        // Commit
        $message = 'Smart Select Implementation - ' . date('Y-m-d H:i:s');
        $files = array_merge($this->filesCreated, $this->filesModified);
        $message .= "\n\nFiles created: " . implode(', ', $this->filesCreated);
        $message .= "\nFiles modified: " . implode(', ', $this->filesModified);
        
        exec('git commit -m "' . $message . '" 2>&1', $output, $returnCode);
        
        if ($returnCode === 0) {
            echo "âœ… Commit ×‘×•×¦×¢ ×‘×”×¦×œ×—×”\n";
            
            // Push
            exec('git push origin main 2>&1', $output, $returnCode);
            
            if ($returnCode === 0) {
                echo "âœ… Push ×œ×’×™×˜ ×‘×•×¦×¢ ×‘×”×¦×œ×—×”\n";
            } else {
                echo "âš ï¸ ×‘×¢×™×” ×‘-Push, ×‘×¦×¢ ×™×“× ×™×ª: git push origin 
main\n";
            }
        } else {
            echo "âš ï¸ ×œ× ×”×™×• ×©×™× ×•×™×™× ×œ-commit ××• 
×©×”×™×ª×” ×©×’×™××”\n";
        }
    }
    
    /**
     * ×”×“×¤×¡×ª ×¡×™×›×•×
     */
    private function printSummary() {
        echo "\n";
        echo "========================================\n";
        echo "   âœ… ×”×”×ª×§× ×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”!\n";
        echo "========================================\n";
        echo "\n";
        echo "ğŸ“ ×§×‘×¦×™× ×©× ×•×¦×¨×•:\n";
        foreach ($this->filesCreated as $file) {
            echo "   â€¢ $file\n";
        }
        
        echo "\nğŸ“ ×§×‘×¦×™× ×©×¢×•×“×›× ×•:\n";
        foreach ($this->filesModified as $file) {
            echo "   â€¢ $file\n";
        }
        
        echo "\nğŸ¯ ×”×©×œ×‘×™× ×”×‘××™×:\n";
        echo "1. ×‘×“×•×§ ××ª ×”×˜×•×¤×¡ ×œ×“×•×’××”:\n";
        echo "   /dashboard/dashboards/cemeteries/forms/smart-select-example.php\n";
        echo "\n";
        echo "2. ×”×©×ª××© ×‘-SmartSelect ×‘×˜×¤×¡×™×:\n";
        echo '   $formBuilder->addField("field", "Label", "smart_select", [...]);' . "\n";
        echo "\n";
        echo "3. ×‘××—×©×‘ ×”××§×•××™:\n";
        echo "   cd /Users/malkiel/projects/login/login\n";
        echo "   git pull origin main\n";
        echo "\n";
        echo "ğŸ“š ×ª×™×¢×•×“ ××œ× ×‘×§×‘×¦×™×:\n";
        echo "   â€¢ SmartSelect.php - ×”×§×•××¤×•× × ×˜×” ×”×¨××©×™×ª\n";
        echo "   â€¢ smart-select.js - ×œ×•×’×™×§×ª JavaScript\n";
        echo "   â€¢ smart-select.css - ×¢×™×¦×•×‘\n";
        echo "   â€¢ smart-select-example.php - ×“×•×’×××•×ª ×©×™××•×©\n";
        echo "\n";
    }
    
    /**
     * Rollback ×‘××§×¨×” ×©×œ ×©×’×™××”
     */
    private function rollback() {
        echo "\nâš ï¸ ××‘×¦×¢ rollback...\n";
        
        // ××—×§ ×§×‘×¦×™× ×©× ×•×¦×¨×•
        foreach ($this->filesCreated as $file) {
            $fullPath = $this->formsPath . '/' . $file;
            if (file_exists($fullPath)) {
                unlink($fullPath);
                echo "   â€¢ ××—×§ $file\n";
            }
        }
        
        // ×”×—×–×¨ ××’×™×‘×•×™ ×× ×§×™×™×
        if (is_dir($this->backupDir)) {
            $this->copyDirectory($this->backupDir . '/forms', $this->formsPath);
            echo "âœ… ×©×•×—×–×¨ ××’×™×‘×•×™\n";
        }
    }
    
    /**
     * ×”×¢×ª×§×ª ×ª×™×§×™×™×” ×¨×§×•×¨×¡×™×‘×™×ª
     */
    private function copyDirectory($src, $dst) {
        if (!is_dir($src)) return;
        
        if (!is_dir($dst)) {
            mkdir($dst, 0755, true);
        }
        
        $dir = opendir($src);
        while (($file = readdir($dir)) !== false) {
            if ($file != '.' && $file != '..') {
                $srcPath = $src . '/' . $file;
                $dstPath = $dst . '/' . $file;
                
                if (is_dir($srcPath)) {
                    $this->copyDirectory($srcPath, $dstPath);
                } else {
                    copy($srcPath, $dstPath);
                }
            }
        }
        closedir($dir);
    }
}

// ×”×¨×¦×ª ×”×¡×§×¨×™×¤×˜
try {
    $fixer = new SmartSelectFixer();
    $fixer->run();
} catch (Exception $e) {
    echo "\nâŒ ×©×’×™××” ×§×¨×™×˜×™×ª: " . $e->getMessage() . "\n";
    exit(1);
}

echo "\nâœ¨ ×¡×™×•× ×”×¨×¦×” âœ¨\n";
