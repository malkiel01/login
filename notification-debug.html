<!-- notification-debug.html - מערכת דיבאג מקיפה להתראות -->
<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Panel - מערכת התראות</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- פאנל דיבאג משופר -->
    <div id="debug-panel" style="position: fixed; bottom: 10px; right: 10px; background: white; 
        border: 2px solid #667eea; border-radius: 10px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
        z-index: 9999; direction: rtl; font-size: 12px; width: 350px; max-height: 600px; display: flex; flex-direction: column;">
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h4 style="margin: 0; color: #667eea;">🔧 פאנל דיבאג התראות</h4>
            <button onclick="toggleDebugPanel()" style="background: transparent; border: none; cursor: pointer; font-size: 16px;">
                <i class="fas fa-minus"></i>
            </button>
        </div>
        
        <!-- מידע משתמש -->
        <div style="background: #f0f8ff; padding: 8px; border-radius: 5px; margin-bottom: 10px;">
            <strong>משתמש:</strong> <span id="user-email">לא מחובר</span><br>
            <strong>סטטוס:</strong> <span id="connection-status">🔴 מנותק</span><br>
            <strong>הרשאות:</strong> <span id="permission-status">בודק...</span>
        </div>
        
        <!-- כפתורי בדיקה -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
            <button onclick="testPermissions()" style="background: #667eea; color: white; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-key"></i> הרשאות
            </button>
            
            <button onclick="testLocalNotification()" style="background: #28a745; color: white; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-bell"></i> התראה מקומית
            </button>
            
            <button onclick="testServerConnection()" style="background: #ffc107; color: black; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-server"></i> בדוק שרת
            </button>
            
            <button onclick="checkPendingNotifications()" style="background: #17a2b8; color: white; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-inbox"></i> התראות ממתינות
            </button>
            
            <button onclick="testPushAPI()" style="background: #6f42c1; color: white; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-rocket"></i> Push API
            </button>
            
            <button onclick="clearDebugLog()" style="background: #dc3545; color: white; border: none; 
                    padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px;">
                <i class="fas fa-trash"></i> נקה לוג
            </button>
        </div>
        
        <!-- מונה התראות -->
        <div style="background: #e9ecef; padding: 8px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-around;">
            <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: bold; color: #28a745;" id="success-count">0</div>
                <div style="font-size: 10px;">הצליחו</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: bold; color: #ffc107;" id="pending-count">0</div>
                <div style="font-size: 10px;">ממתינות</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: bold; color: #dc3545;" id="failed-count">0</div>
                <div style="font-size: 10px;">נכשלו</div>
            </div>
        </div>
        
        <!-- לוג מפורט -->
        <div id="debug-output" style="background: #1e1e1e; color: #00ff00; border-radius: 5px; padding: 10px; 
            font-family: 'Courier New', monospace; font-size: 11px; flex: 1; overflow-y: auto; min-height: 200px;">
            <div style="color: #ffff00;">🚀 מערכת דיבאג פעילה...</div>
        </div>
        
        <!-- פעולות נוספות -->
        <div style="margin-top: 10px; display: flex; gap: 5px;">
            <button onclick="exportDebugLog()" style="background: #6c757d; color: white; border: none; 
                    padding: 5px 10px; border-radius: 5px; font-size: 10px; cursor: pointer;">
                <i class="fas fa-download"></i> ייצא לוג
            </button>
            <button onclick="toggleAutoRefresh()" style="background: #20c997; color: white; border: none; 
                    padding: 5px 10px; border-radius: 5px; font-size: 10px; cursor: pointer;">
                <i class="fas fa-sync"></i> <span id="auto-refresh-btn">רענון אוטומטי: כבוי</span>
            </button>
            <button onclick="document.getElementById('debug-panel').style.display='none'" 
                    style="background: #dc3545; color: white; border: none; 
                    padding: 5px 10px; border-radius: 5px; font-size: 10px; cursor: pointer;">
                <i class="fas fa-times"></i> סגור
            </button>
        </div>
    </div>

    <!-- מיני פאנל כשמוקטן -->
    <div id="mini-debug" style="position: fixed; bottom: 10px; right: 10px; background: #667eea; 
        border-radius: 50%; width: 50px; height: 50px; display: none; align-items: center; 
        justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 9999;"
        onclick="toggleDebugPanel()">
        <i class="fas fa-bug" style="color: white; font-size: 20px;"></i>
        <span id="mini-badge" style="position: absolute; top: -5px; right: -5px; background: #dc3545; 
            color: white; border-radius: 50%; width: 20px; height: 20px; display: none; 
            align-items: center; justify-content: center; font-size: 10px; font-weight: bold;">0</span>
    </div>

    <script>
        // משתנים גלובליים
        let debugHistory = [];
        let notificationCounts = { success: 0, pending: 0, failed: 0 };
        let autoRefreshInterval = null;
        let isAutoRefresh = false;
        let userEmail = sessionStorage.getItem('userEmail') || 'לא מחובר';
        let notificationListener = null;

        // אתחול
        window.addEventListener('DOMContentLoaded', () => {
            initDebugPanel();
            startNotificationListener();
            checkInitialStatus();
        });

        // אתחול פאנל
        function initDebugPanel() {
            // קבל מידע משתמש
            fetch('/login/api/simple-notifications.php?action=get-user-info', { credentials: 'include' })
                .then(r => r.json())
                .then(data => {
                    if (data.email) {
                        userEmail = data.email;
                        document.getElementById('user-email').textContent = userEmail;
                        debugLog(`👤 משתמש: ${userEmail}`, 'info');
                    }
                })
                .catch(err => debugLog('❌ שגיאה בקבלת מידע משתמש', 'error'));

            // בדוק הרשאות
            updatePermissionStatus();
            
            // בדוק Service Worker
            checkServiceWorker();
        }

        // בדיקת סטטוס ראשוני
        function checkInitialStatus() {
            debugLog('🔍 בודק סטטוס מערכת...', 'system');
            
            // בדוק תמיכה
            const checks = {
                'Notification API': 'Notification' in window,
                'Service Worker': 'serviceWorker' in navigator,
                'Push Manager': 'PushManager' in window,
                'Promise': 'Promise' in window
            };

            Object.entries(checks).forEach(([feature, supported]) => {
                debugLog(`${supported ? '✅' : '❌'} ${feature}`, supported ? 'success' : 'error');
            });

            // בדוק חיבור
            updateConnectionStatus(navigator.onLine);
            
            window.addEventListener('online', () => {
                updateConnectionStatus(true);
                debugLog('🌐 חזרנו לאונליין!', 'success');
            });
            
            window.addEventListener('offline', () => {
                updateConnectionStatus(false);
                debugLog('📵 אין חיבור לרשת', 'error');
            });
        }

        // האזנה להתראות
        function startNotificationListener() {
            debugLog('👂 מתחיל האזנה להתראות...', 'system');
            
            // האזנה ל-Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.addEventListener('message', (event) => {
                    debugLog(`📨 הודעה מ-SW: ${JSON.stringify(event.data)}`, 'notification');
                    handleIncomingNotification(event.data);
                });
            }

            // האזנה ל-Notification API
            if ('Notification' in window) {
                // אין אירוע ישיר, אבל נוכל לבדוק דרך Permission
                setInterval(() => {
                    updatePermissionStatus();
                }, 5000);
            }

            // פולינג לשרת
            startServerPolling();
        }

        // פולינג לשרת
        function startServerPolling() {
            // בדוק כל 10 שניות
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    checkPendingNotifications(true); // silent mode
                }
            }, 10000);
        }

        // טיפול בהתראה נכנסת
        function handleIncomingNotification(data) {
            const timestamp = new Date().toLocaleTimeString('he-IL');
            debugLog(`🔔 [${timestamp}] התראה חדשה:`, 'notification');
            debugLog(`   כותרת: ${data.title || 'ללא'}`, 'notification');
            debugLog(`   תוכן: ${data.body || 'ללא'}`, 'notification');
            debugLog(`   סוג: ${data.type || 'כללי'}`, 'notification');
            
            if (data.email === userEmail || data.to === userEmail) {
                debugLog(`   ✅ התראה למשתמש הנוכחי!`, 'success');
                notificationCounts.success++;
            } else {
                debugLog(`   ⚠️ התראה למשתמש אחר: ${data.email || data.to}`, 'warning');
            }
            
            updateCounters();
            updateMiniBadge();
        }

        // בדיקת הרשאות
        async function testPermissions() {
            debugLog('🔐 בודק הרשאות...', 'system');
            
            if (!('Notification' in window)) {
                debugLog('❌ הדפדפן לא תומך בהתראות', 'error');
                return;
            }
            
            const permission = Notification.permission;
            debugLog(`📋 הרשאה נוכחית: ${permission}`, permission === 'granted' ? 'success' : 'warning');
            
            if (permission === 'default') {
                debugLog('📝 מבקש הרשאה...', 'info');
                try {
                    const result = await Notification.requestPermission();
                    debugLog(`✅ תשובה: ${result}`, result === 'granted' ? 'success' : 'error');
                    updatePermissionStatus();
                } catch (err) {
                    debugLog(`❌ שגיאה: ${err.message}`, 'error');
                }
            }
        }

        // התראה מקומית
        async function testLocalNotification2() {
            debugLog('🔔 שולח התראה מקומית...', 'system');
            
            if (Notification.permission !== 'granted') {
                debugLog('⚠️ אין הרשאה - מבקש...', 'warning');
                await testPermissions();
                if (Notification.permission !== 'granted') return;
            }
            
            try {
                const timestamp = new Date().toLocaleTimeString('he-IL');
                const notification = new Notification('בדיקה 🔔', {
                    body: `התראת בדיקה - ${timestamp}`,
                    icon: '/login/images/icons/android/android-launchericon-192-192.png',
                    badge: '/login/images/icons/android/android-launchericon-96-96.png',
                    tag: 'test-' + Date.now(),
                    requireInteraction: false,
                    dir: 'rtl',
                    lang: 'he'
                });
                
                notification.onclick = () => {
                    debugLog('👆 התראה נלחצה!', 'success');
                    notification.close();
                };
                
                debugLog('✅ התראה נשלחה בהצלחה!', 'success');
                notificationCounts.success++;
                updateCounters();
                
                // סגור אחרי 5 שניות
                setTimeout(() => notification.close(), 5000);
                
            } catch (err) {
                debugLog(`❌ שגיאה: ${err.message}`, 'error');
                notificationCounts.failed++;
                updateCounters();
            }
        }


        // התראה מקומית - גרסה מתוקנת ל-HTTPS
        async function testLocalNotification() {
            debugLog('🔔 שולח התראה מקומית...', 'system');
            
            // בדוק הרשאות
            if (Notification.permission !== 'granted') {
                debugLog('⚠️ אין הרשאה - מבקש...', 'warning');
                await testPermissions();
                if (Notification.permission !== 'granted') return;
            }
            
            try {
                // ב-HTTPS חייבים להשתמש ב-Service Worker
                if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
                    debugLog('🔒 HTTPS detected - using Service Worker', 'info');
                    
                    const registration = await navigator.serviceWorker.ready;
                    const timestamp = new Date().toLocaleTimeString('he-IL');
                    
                    await registration.showNotification('בדיקה 🔔', {
                        body: `התראת בדיקה - ${timestamp}`,
                        icon: '/login/images/icons/android/android-launchericon-192-192.png',
                        badge: '/login/images/icons/android/android-launchericon-96-96.png',
                        tag: 'test-' + Date.now(),
                        requireInteraction: false,
                        vibrate: [200, 100, 200],
                        dir: 'rtl',
                        lang: 'he',
                        silent: false,
                        data: {
                            type: 'test',
                            timestamp: timestamp
                        }
                    });
                    
                    debugLog('✅ התראה נשלחה בהצלחה דרך Service Worker!', 'success');
                    notificationCounts.success++;
                    updateCounters();
                    
                } else if (window.location.protocol === 'http:') {
                    // רק ב-HTTP אפשר להשתמש ב-Notification API רגיל
                    debugLog('🔓 HTTP detected - using standard Notification API', 'info');
                    
                    const timestamp = new Date().toLocaleTimeString('he-IL');
                    const notification = new Notification('בדיקה 🔔', {
                        body: `התראת בדיקה - ${timestamp}`,
                        icon: '/login/images/icons/android/android-launchericon-192-192.png',
                        tag: 'test-' + Date.now(),
                        dir: 'rtl',
                        lang: 'he'
                    });
                    
                    notification.onclick = () => {
                        debugLog('👆 התראה נלחצה!', 'success');
                        notification.close();
                    };
                    
                    debugLog('✅ התראה נשלחה בהצלחה!', 'success');
                    notificationCounts.success++;
                    updateCounters();
                    
                    setTimeout(() => notification.close(), 5000);
                    
                } else {
                    debugLog('❌ לא ניתן לשלוח התראה בסביבה הנוכחית', 'error');
                }
                
            } catch (err) {
                debugLog(`❌ שגיאה: ${err.message}`, 'error');
                notificationCounts.failed++;
                updateCounters();
                
                // נסה fallback לבאנר בדף
                debugLog('📋 מנסה באנר חלופי...', 'info');
                showInPageNotification('בדיקה 🔔', 'התראת בדיקה - ' + new Date().toLocaleTimeString('he-IL'));
            }
        }

        // פונקציית עזר לבאנר בדף
        function showInPageNotification(title, body) {
            const banner = document.createElement('div');
            banner.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: white;
                border: 2px solid #667eea;
                border-radius: 10px;
                padding: 15px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideDown 0.5s ease;
                direction: rtl;
                min-width: 300px;
            `;
            
            banner.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 30px;">🔔</div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 5px 0; color: #667eea;">${title}</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">${body}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 20px; 
                                color: #999; cursor: pointer;">×</button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // הוסף אנימציה
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            debugLog('✅ באנר הוצג בהצלחה', 'success');
            
            // הסר אחרי 5 שניות
            setTimeout(() => banner.remove(), 5000);
        }

// ----

        // בדיקת חיבור לשרת
        async function testServerConnection() {
            debugLog('🌐 בודק חיבור לשרת...', 'system');
            
            try {
                const response = await fetch('/login/api/simple-notifications.php?action=test', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    debugLog(`✅ השרת מגיב: ${JSON.stringify(data)}`, 'success');
                    updateConnectionStatus(true);
                } else {
                    debugLog(`❌ שגיאת שרת: ${response.status}`, 'error');
                    updateConnectionStatus(false);
                }
            } catch (err) {
                debugLog(`❌ אין חיבור: ${err.message}`, 'error');
                updateConnectionStatus(false);
            }
        }

        // בדיקת התראות ממתינות
        async function checkPendingNotifications(silent = false) {
            if (!silent) debugLog('📥 בודק התראות ממתינות...', 'system');
            
            try {
                const response = await fetch('/login/api/simple-notifications.php?action=get-pending', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.notifications && data.notifications.length > 0) {
                        debugLog(`📬 נמצאו ${data.notifications.length} התראות:`, 'notification');
                        data.notifications.forEach((n, i) => {
                            debugLog(`  ${i+1}. ${n.title || 'ללא כותרת'}`, 'notification');
                            handleIncomingNotification(n);
                        });
                        notificationCounts.pending = data.notifications.length;
                    } else if (!silent) {
                        debugLog('📭 אין התראות ממתינות', 'info');
                    }
                    updateCounters();
                } else if (!silent) {
                    debugLog(`⚠️ תגובת שרת: ${response.status}`, 'warning');
                }
            } catch (err) {
                if (!silent) debugLog(`❌ שגיאה: ${err.message}`, 'error');
            }
        }

        // בדיקת Push API
        async function testPushAPI() {
            debugLog('🚀 בודק Push API...', 'system');
            
            if (!('PushManager' in window)) {
                debugLog('❌ אין תמיכה ב-Push API', 'error');
                return;
            }
            
            try {
                const registration = await navigator.serviceWorker.ready;
                debugLog('✅ Service Worker מוכן', 'success');
                
                const subscription = await registration.pushManager.getSubscription();
                if (subscription) {
                    debugLog('📱 יש מנוי פעיל:', 'success');
                    debugLog(`   Endpoint: ${subscription.endpoint.substr(0, 50)}...`, 'info');
                } else {
                    debugLog('📵 אין מנוי פעיל', 'warning');
                    
                    // נסה ליצור מנוי
                    debugLog('📝 מנסה ליצור מנוי חדש...', 'info');
                    try {
                        const newSub = await registration.pushManager.subscribe({
                            userVisibleOnly: true
                        });
                        debugLog('✅ מנוי נוצר בהצלחה!', 'success');
                    } catch (err) {
                        debugLog(`❌ כשלון ביצירת מנוי: ${err.message}`, 'error');
                    }
                }
            } catch (err) {
                debugLog(`❌ שגיאה: ${err.message}`, 'error');
            }
        }

        // בדיקת Service Worker
        async function checkServiceWorker() {
            if (!('serviceWorker' in navigator)) {
                debugLog('❌ אין תמיכה ב-Service Worker', 'error');
                return;
            }
            
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length > 0) {
                    debugLog(`✅ Service Worker רשום: ${registrations.length} instances`, 'success');
                    registrations.forEach((reg, i) => {
                        debugLog(`   ${i+1}. Scope: ${reg.scope}`, 'info');
                    });
                } else {
                    debugLog('⚠️ אין Service Worker רשום', 'warning');
                }
            } catch (err) {
                debugLog(`❌ שגיאת SW: ${err.message}`, 'error');
            }
        }

        // עדכון סטטוס הרשאות
        function updatePermissionStatus() {
            if ('Notification' in window) {
                const permission = Notification.permission;
                const statusEl = document.getElementById('permission-status');
                
                if (permission === 'granted') {
                    statusEl.innerHTML = '<span style="color: green;">✅ מאושר</span>';
                } else if (permission === 'denied') {
                    statusEl.innerHTML = '<span style="color: red;">❌ נדחה</span>';
                } else {
                    statusEl.innerHTML = '<span style="color: orange;">⏳ ממתין</span>';
                }
            }
        }

        // עדכון סטטוס חיבור
        function updateConnectionStatus(isOnline) {
            const statusEl = document.getElementById('connection-status');
            if (isOnline) {
                statusEl.innerHTML = '🟢 מחובר';
            } else {
                statusEl.innerHTML = '🔴 מנותק';
            }
        }

        // עדכון מונים
        function updateCounters() {
            document.getElementById('success-count').textContent = notificationCounts.success;
            document.getElementById('pending-count').textContent = notificationCounts.pending;
            document.getElementById('failed-count').textContent = notificationCounts.failed;
        }

        // עדכון תג מיני
        function updateMiniBadge() {
            const total = notificationCounts.success + notificationCounts.pending;
            const badge = document.getElementById('mini-badge');
            if (total > 0) {
                badge.textContent = total;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // כתיבה ללוג
        function debugLog(msg, type = 'info') {
            const output = document.getElementById('debug-output');
            const time = new Date().toLocaleTimeString('he-IL');
            
            // צבעים לפי סוג
            const colors = {
                'info': '#00ff00',
                'warning': '#ffff00',
                'error': '#ff0000',
                'success': '#00ff00',
                'notification': '#00ffff',
                'system': '#ff00ff'
            };
            
            const color = colors[type] || '#ffffff';
            const entry = `<div style="color: ${color}; margin: 2px 0;">[${time}] ${msg}</div>`;
            
            output.innerHTML = entry + output.innerHTML;
            
            // שמור בהיסטוריה
            debugHistory.push({ time, msg, type });
            
            // הגבל ל-100 שורות
            const lines = output.querySelectorAll('div');
            if (lines.length > 100) {
                lines[lines.length - 1].remove();
            }
        }

        // ניקוי לוג
        function clearDebugLog() {
            document.getElementById('debug-output').innerHTML = '<div style="color: #ffff00;">🚀 לוג נוקה...</div>';
            debugHistory = [];
            notificationCounts = { success: 0, pending: 0, failed: 0 };
            updateCounters();
            updateMiniBadge();
        }

        // ייצוא לוג
        function exportDebugLog() {
            const content = debugHistory.map(entry => 
                `[${entry.time}] [${entry.type.toUpperCase()}] ${entry.msg}`
            ).join('\n');
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `notification-debug-${new Date().toISOString()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            debugLog('📁 לוג יוצא לקובץ', 'success');
        }

        // החלפת מצב רענון אוטומטי
        function toggleAutoRefresh() {
            isAutoRefresh = !isAutoRefresh;
            const btn = document.getElementById('auto-refresh-btn');
            
            if (isAutoRefresh) {
                btn.textContent = 'רענון אוטומטי: פעיל';
                autoRefreshInterval = setInterval(() => {
                    checkPendingNotifications(true);
                }, 5000);
                debugLog('🔄 רענון אוטומטי הופעל', 'success');
            } else {
                btn.textContent = 'רענון אוטומטי: כבוי';
                clearInterval(autoRefreshInterval);
                debugLog('⏸️ רענון אוטומטי הופסק', 'info');
            }
        }

        // החלפת תצוגת פאנל
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            const mini = document.getElementById('mini-debug');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'flex';
                mini.style.display = 'none';
            } else {
                panel.style.display = 'none';
                mini.style.display = 'flex';
            }
        }

        // הוסף פונקציה גלובלית לקבלת התראות
        window.debugNotification = function(title, body, data = {}) {
            handleIncomingNotification({
                title,
                body,
                ...data,
                email: userEmail
            });
        };
    </script>

    <!-- דוגמה לשימוש -->
    <div style="padding: 100px; text-align: center;">
        <h1>דף בדיקת התראות</h1>
        <p>פאנל הדיבאג נמצא בפינה הימנית התחתונה</p>
        
        <button onclick="debugNotification('התראה ידנית', 'זו התראה שנשלחה ידנית', {type: 'test'})" 
                style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
            שלח התראה ידנית
        </button>
    </div>
</body>
</html>