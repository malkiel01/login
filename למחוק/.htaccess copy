# הפעלת mod_rewrite
RewriteEngine On

# הגנה על קבצי ENV
<Files .env>
    Order allow,deny
    Deny from all
</Files>

# הגנה על קובץ config
<Files config.php>
    Order allow,deny
    Deny from all
</Files>

# חסימת גישה ישירה לקבצי PHP בתיקיות includes
RewriteRule ^includes/.*\.php$ - [F,L]

# חסימת גישה ישירה לקבצי דיבאג וטסט
RewriteRule ^(debug|test.*|find.*)\.php$ - [F,L]

# הגדרת AJAX token check - מאפשר רק בקשות AJAX לקבצים מסוימים
RewriteCond %{REQUEST_METHOD} POST
RewriteCond %{HTTP:X-Requested-With} !XMLHttpRequest
RewriteRule ^(dashboard|group)\.php$ - [F,L]

# הגנה על תיקיות רגישות
RewriteRule ^(vendor|logs|cache|sessions)/.*$ - [F,L]

# הפניה של כל בקשה לא מורשית ל-index
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^.*$ index.php [L]

# הגדרות אבטחה נוספות
Options -Indexes
Options -MultiViews

# הגנה על קבצי גיבוי
<FilesMatch "\.(bak|backup|sql|log|ini)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# הגדרת headers לאבטחה
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# הגבלת גודל העלאות
php_value upload_max_filesize 5M
php_value post_max_size 10M

# הגדרת charset
AddDefaultCharset UTF-8

# מניעת גישה ל-git
RedirectMatch 404 /\.git

# Custom error pages
ErrorDocument 403 /index.php
ErrorDocument 404 /index.php
ErrorDocument 500 /index.php